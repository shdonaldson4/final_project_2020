---
title             : "Assessing US Personality Structure and Cross Cultural Comparisons"
shorttitle        : "Personality Structure and Comparisons"

author: 
  - name          : "Vinita Vader"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    email         : "vvader@uoregon.edu"
    # #role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
    #   - Conceptualization of PCA
    #   - Coding - Analysis plan and initial coding
    #   - Writing - Original draft preparation
    #   - Writing - Review & editing
  - name          : "Xiaoyu Liu"
    affiliation   : "1"
    # role:
    #   - Coding - Data wrangling, regression analysis, and visualization
    #   - Writing - Review & Editing
      
  - name          : "Sarah Donaldson"
    affiliation   : "1"
    # role:
    #   - Conceptualization of Regression Analyses
    #   - Coding - Data wrangling, regression analysis, and visualization
    #   - Writing - Contribution to Introduction, Results, and Discussion, Review & Editing
affiliation:
  - id            : "1"
    institution   : "University of Oregon"


authornote: |

  Vinita Vader and Sarah Donaldson are members of the Psychology Department at the University of Oregon.
  Xiaoyu Liu is a member of the _______ Department at the University of Oregon

abstract: |
  Several studies have supported the replicability of the Big 5 model across cultures, languages and populations. First, this study looks at the factor structure of personality in a karge US sample. A parallel analysis suggested extracting 7 factors which were further subjected to a principal components analysis. Factors structures emerging from varimax and oblimin rotations were examined. Second, this study compared personality differences across gender (male vs. female) and regions (Great Britain vs. India) Two separate Between-Subjects ANOVAs were run to examine regional and gender differences in extraversion (Model 1) and in openness to experience (Model 2).

  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "Big 5, personality, parallel analysis, varimax, oblimin, cultural differences, gender differences"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
options(Encoding="UTF-8")
knitr::opts_chunk$set(
	eval = T,
	echo = FALSE,
	fig.height = 7,
	fig.width = 8,
	message = FALSE,
	errors = TRUE,
	warnings = FALSE,
	message = FALSE
)


library(scales) 
library(tidyverse)
library(rio)
library(here)
library(janitor)
library(papaja)
library(tinytex)
library(knitr)
library(paran)
library(psych)
if(!require(devtools)){
   install.packages("devtools")
}
devtools::install_github("rkabacoff/factorAnalysis") #Not on cran
library("papaja")
#library(xlsx)
library(rstatix)
if(!require(GPArotation)){
   install.packages("devtools")}
library(ggpubr)
library(GPArotation)
r_refs("r-references.bib")


raw_data = import(here("data", "data.csv"), setclass = "tbl_df")
```


# Introduction 

<!-- Please explain emic vs etic structures -->
The Five Factor Model of personality structure (FFM) proposes that personality can be divided into five unique facets: Extraversion, Openness to Experience, Agreeableness, Conscientiousness, and Neuroticism. Typically, the Big Five Personality Inventory [BFI; @john1991]  has garnered support due to a strict extraction of these five factors. However, this has limited the scope of how personality has been understood across cultures. There is a need to understand the emic structures over imposing etic structures on datasets. We need to focus on how we could add a more stringent way of unearthing personality models. A more robust model would be the one that emerges through emic methods rather than etic methods. Using a large, open-source dataset, we will investigate whether the FFM remains true for U.S. participants. As an exploratory analysis, there is no prediction as to the number of factors that may emerge.

The comparison of personality factors between genders and countries is important to our understanding of general human variation [@weisberg2011]. Most gender comparisons report women scoring higher than men in extraversion [@goodwin2004; @weisberg2011]. However most of this work has been done in white, U.S. samples, and when @lynn1997 collected a large, cross-cultural dataset, men were found to display higher levels of extraversion compared to women in 30 out of 37 countries examined [@lynn1997]. In only 5 countries (including the United States, Mexico, France, Austria, and Japan) women scored significantly higher than men [@lynn1997], showing the importance of regional differences in gender-based personality comparisons. 

The trait of openness to experience (OE) reflects imagination, creativity, intellectual curiosity, and an appreciation for new, complex, aesthetic experiences [@weisberg2011]. Gender comparisons on this trait are mixed world-wide. As an overall factor, very few gender differences are found [baer2008; @costa2001; @silva2010]. It is only when this factor is broken down into sub-categories that gender differences emerge. For example, men tend to score higher on openness to ideas, while women have been found to score higher than men on openness to aesthetics and feelings [@costa2001; @weisberg2011]. Further, the extent of gender differences in openness differs by country, with larger differences found in countries with more traditional male and female gender roles, such as in eastern cultures [@costa2001]. Therefore, comparing personality differences by gender and country can identify important cultural distinctions on typical gender stereotypes.

This study investigated gender differences by country, comparing Great Britain (including England, Whales, and Scotland, but not Northern Ireland) to India. These countries are compared because they are represented in roughly even numbers in this dataset, and because of their cultural differences in gender stereotypes. Great Britain has had more open and accepting views of gender roles over a longer period of time compared to more conservative, traditional stereotypes upheld in many Indian cultures until relatively recently [@saewyc2017]. For extraversion it was hypothesized that overall, males would score higher than females, however this gender difference should be greater in Indian participants compared to participants in Great Britain. There was no prediction about differences in extraversion between the two countries. For OE, it was predicted that gender differences will emerge in India, but not in Great Britain, with women scoring higher than men in India on this trait. Further, it was proposed that Great Britain participants would score higher on OE compared to Indian participants.



```{r Data-cleaning, eval=TRUE, echo=TRUE, include=FALSE}

#Look at all the variables in teh data
h = raw_data %>% 
  mutate_if(is.integer, as.numeric) %>% 
  select_if(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_boxplot()+
    theme_minimal()
dim(raw_data)

#final data to be used
data = raw_data %>% 
  dplyr::select(-c(race,engnat,hand,source)) %>%  #retain only those columns required for the analysis
  filter(country == "US", age >=18 & age <= 80 ) %>%  #Use ONLY US cases, and age between 18 and 80 years
  filter_if(is.numeric, all_vars((.) != 0)) %>%  #dropping all rows with missing values
  mutate(gender = recode(gender, `1` = "Male", `2` = "Female", `3` = "Other")) %>% 
  filter(gender != "Other") %>% #retain only males and females
    rowwise() %>%
  #score variables, r annoted are reverse scored items
  mutate(E4r = (6-E4), 
         E6r = (6-E6),
         E8r = (6-E8),
         E10r = (6-E10),
         N2r = (6-N2),
         N4r = (6-N4),
         A1r = (6-A1),
         A3r = (6-A3), 
         A5r = (6-A5),
         A7r = (6-A7),
         C2r = (6-C2),
         C4r = (6-C4),
         C6r = (6-C6),
         C8r = (6-C8),
         O2r = (6-O2),
         O4r = (6-O4)) %>% 
 mutate(E = sum(E1, E2, E3,E4r, E5,E6r, E7, E8r, E9, E10r),
  N = sum(N1, N2r, N3, N4r, N5, N5, N6, N7, N8, N9, N10),
  A = sum(A1r, A2, A3r, A4, A5r, A6, A7r, A8, A9, A10),
  C = sum(C1, C2r, C3, C4r, C5, C6r, C7, C8r, C9, C10),
  O =sum(O1, O2r, O3, O4r, O5, O6, O7)
 ) 

gender.count = data %>% 
   group_by(gender) %>%
 summarise(gender_count=n())

gender.count[1,2]
```

```{r Descriptives, eval=TRUE, echo=TRUE, include=FALSE}
MeanDF = data %>% 
  dplyr::select(gender, E:O) %>% 
  group_by(gender) %>% 
  summarise(A = mean(A),
            C = mean(C),
            E = mean(E),
            N = mean(N),
            O = mean(O)) %>% 
  pivot_longer(
    cols = c(A:O),
    names_to =c("variables"),
    values_to = "values") %>% 
  pivot_wider(names_from = gender, 
    values_from = values)

tDF = data %>% 
  dplyr::select(E, N, A, C, O, gender) %>%
  pivot_longer(-gender, names_to = "variables",  values_to = "value") %>% 
  group_by(variables) %>%
  t_test(value ~ gender) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance()

  
E.df = data %>% 
  dplyr::select(E1, E2, E3,E4r, E5,E6r, E7, E8r, E9, E10r) %>% 
 mutate_if(is.integer,as.numeric)

N.df = data %>% 
  dplyr::select(N1, N2r, N3, N4r, N5, N6, N7, N8, N9, N10) %>% 
 mutate_if(is.integer,as.numeric)
  
A.df = data %>% 
  dplyr::select(A1r, A2, A3r, A4, A5r, A6, A7r, A8, A9, A10) %>% 
  mutate_if(is.integer,as.numeric)

C.df = data %>% 
  dplyr::select(C1, C2r, C3, C4r, C5, C6r, C7, C8r, C9, C10) %>% 
  mutate_if(is.integer,as.numeric)

O.df = data %>% 
  dplyr::select(O1, O2r, O3, O4r, O5, O6, O7) %>% 
  mutate_if(is.integer,as.numeric)

aDF = c(E = psychometric::alpha(E.df),
N = psychometric::alpha(N.df),
A = psychometric::alpha(A.df),
C = psychometric::alpha(C.df),
O = psychometric::alpha(O.df))

aDF = aDF %>% 
       as.data.frame() %>% 
       rownames_to_column(var = "variables") %>% 
       dplyr::rename(alpha = ".") %>% 
  as_tibble()
  

tDF = tDF %>% 
  select(variables, statistic, p) 
```

```{r descriptiveTable, results = "asis"}
table = dplyr::inner_join(MeanDF, tDF, by="variables") 
dplyr::left_join(table, aDF, by="variables") %>%
  dplyr::rename(t ="statistic") %>% 
  apa_table(align = "c", caption = "Summary statistics", note = "E = Extraversion, N = Neuroticism, A = Agreeableness, C = Conscientiousness, O = Openness/Intellect, t = t statistic value, p =p values for corresponding t values, a = Chronbach's alpha" )
```

# Methods

## Procedure
The dataset for the analysis was obtained from $Open-Source Psychometrics Project$ repository. This is the link to the website. [Open Source Psychometric project](https://openpsychometrics.org/_rawdata/).It contains data on the Big 5 personality variables $(Extraversion, Neuroticism, Agreeableness, Conscientiousness, Openness to Experience)$ and demographics $(race, age, gender, country)$. `r  nrow(data)` participants voluntarily responded to the questionnaires. We retained participants between the ages of 18 and 80 based on the strogheld assumption that personality develops at the age of 18. For the principal components analysis, only participants from United states of America were used.   Participants (*Females* = `r printnum (gender.count[1,2])`,  *Males*= `r printnum (gender.count[2,2])`) in this study were between the ages, as mentioned previously, of 18 and 80 (*M* = `r printnum(mean(data$age))`, *SD* = `r printnum(sd(data$age))`). 
For the country and gender comparisons, we included participants from Great Britain and from India who identified as either male or female.

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.  Items were reverse scored if needed and total scores were obtained on the Big 5 variables for every participant. We obtained descriptive statistics for all the Big five variables. We used Principal components analysis to study the factor structure of the present data. Parallel analysis was computed to determine the number of factors to be extracted. These factors were further rotated using varimax and oblimin rotations. 

```{r errorbars, fig.cap = "Difference between Males and Females on Big 5 variables", echo = F, fig.height = 6.5, warning = F}
fig.bg5 = data %>% 
  dplyr::select(E, N, A, C, O, gender) %>% 
  group_by(gender) %>% 
  summarise_all(., .funs = c(mean, sd)) %>%   pivot_longer(cols = E_fn1:O_fn2,
                names_to =c("var", "funs"),
                names_pattern = "(.*)_(.*)",
                values_to = "values",
                ) %>% 
  mutate_if(is.character, as.factor) %>% 
  mutate(funs = recode(funs, 
                       fn1 = "mean", 
                       fn2 = "sd")) %>% 
  pivot_wider(names_from = funs, 
    values_from = values) %>% 
  mutate(var = factor(var, levels=c("E", "N", "A", "C", "O"))) %>% 
  ggplot(aes(x=var, color = gender))+
  geom_errorbar(aes(ymin=mean - sd, ymax=mean+sd), width=.2,           position=position_dodge(.9))+
  labs(x = "Big 5 variables",
       y = "Values",
       color = "Gender")+
  jtools::theme_apa(remove.y.gridlines = FALSE, remove.x.gridlines = FALSE, legend.use.title = TRUE, legend.pos = "topright")

fig.bg5
```

```{r PCA.data, eval=TRUE, echo=TRUE, include=FALSE}
PCA.data = data %>% 
  select(E1, E2, E3,E4r, E5,E6r, E7, E8r, E9, E10r,
         N1, N2r, N3, N4r, N5, N5, N6, N7, N8, N9, N10,
         A1r, A2, A3r, A4, A5r, A6, A7r, A8, A9, A10,
         C1, C2r, C3, C4r, C5, C6r, C7, C8r, C9, C10,
         O1, O2r, O3, O4r, O5, O6, O7)

```


```{r parallel-analysis, fig.cap = "Parallel analysis", echo = F, fig.height = 6.5, warning = F}

factorAnalysis::screePlot(cor(PCA.data), method="pc", n.obs=nrow(PCA.data))

```



```{r Rotations, eval=TRUE, echo=TRUE, include=FALSE}
  ##Varimax rotation
R.var = principal(PCA.data, nfactors = 7, rotate = "varimax", normalize = T) #Kaiser normalization will be applied
raw_var = fa.sort(R.var)
df_var = data.frame(unclass(raw_var$loadings))
#write.xlsx(df_var, file = "Rotation outputs.xlsx", row.names = TRUE, sheetName = "varimax", append = FALSE)

  ##Oblimin rotation
R.ob = principal(PCA.data, nfactors = 7, rotate = "oblimin", normalize = T)
struc.mat = R.ob$loadings %*%R.ob$Phi #multiplying the pattern matrix with the covariance matrix from the rotated factors
df_obl = fa.sort(struc.mat)#Interpreting the Structure matrix
#write.xlsx(df_obl, file = "Rotation outputs.xlsx", row.names = TRUE, sheetName = "oblimin", append = TRUE)
```

```{r varimaxTable, results = "asis"}
df_var%>% 
  apa_table(align = "c", caption = "Varimax rotation loadings matrix", font_size = "tiny", note = "E = Extraversion, N = Neuroticism, A = Agreeableness, C = Conscientiousness, O = Openness/Intellect", added_stub_head = "Items")
```

```{r obliminTable, results = "asis"}
df_obl %>% 
  apa_table(align = "c", caption = "Oblimin rotation loadings matrix", font_size = "tiny", note = "E = Extraversion, N = Neuroticism, A = Agreeableness, C = Conscientiousness, O = Openness/Intellect", added_stub_head = "Items") 
```


```{r regression, eval=TRUE, echo=TRUE, include=FALSE}
anova_data_wide = raw_data %>% 
  dplyr::select(-c(race,engnat,hand,source)) %>%  #retain only those columns required for the analysis
  mutate(country = as.factor(country)) %>%
  filter(country == "GB" | country == "IN", age >=18 & age <= 80 ) %>%  #Use ONLY Great Britain and India cases, and age between 18 and 80 years
  filter_if(is.numeric, all_vars((.) != 0)) %>%  #dropping all rows with missing values
  mutate(gender = recode(gender, `1` = "Male", `2` = "Female", `3` = "Other")) %>% 
  filter(gender != "Other") %>% #retain only males and females
  select(c(age,country,gender,O1:O10, E1:E10)) %>%
  rowwise() %>%
  #score variables, r annoted are reverse scored items
  mutate(E4r = (6-E4), 
         E6r = (6-E6),
         E8r = (6-E8),
         E10r = (6-E10),
         O2r = (6-O2),
         O4r = (6-O4)) %>% 
 mutate(E = sum(E1, E2, E3,E4r, E5,E6r, E7, E8r, E9, E10r),
  O =sum(O1, O2r, O3, O4r, O5, O6, O7)) %>%
  select(age,country,gender, E, O) 


# descrptives
anova_data_wide%>%
  pivot_longer(
    cols = c(O, E),
    names_to =  "personality",
    values_to = "values"
  ) %>%
  ggplot(aes(x = values, fill = personality)) +
  geom_histogram() +
  facet_wrap(~personality + country) +
  theme_minimal()

# Anova: 

anovaR <- aov(O ~ country + gender, data = anova_data_wide)
summary(anovaR) 
  

anovaR <- aov(E ~ country + gender, data = anova_data_wide)
summary(anovaR) 


# figures
ggplot(anova_data_wide, aes(x = country, y = O, color = gender)) + 
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Comparison of Openness across Genders between The Great Britain and India",
       x = "country",
       y = "Openness to Experience")

ggplot(anova_data_wide, aes(x = country, y = E, color = gender)) + 
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Comparison of Extraversion across Genders between The Great Britain and India",
       x = "country",
       y = "Extraversion")
 

 


```

# Results
Table\ \@ref(tab:descriptiveTable) displays a summary of differences between males and females and Chronbach's alpha value for all Big 5 variables. There is a significant difference in all the variables for males and females except for Extraversion in this sample. We took a closer look at the error bars to see if there is any overlap. Figure\ \@ref(fig:errorbars) indicates a very high overlap for genders across Big 5 variables with an almost exact range for Extraversion. This indicates that there is not much difference in the levels of Big 5 in males and females in this sample. All the alpha values seem reasonably acceptable except for a low value for Openness. 
Parallel analysis (Horn's method) suggested 7 factors to be retained as seen in Figure\ \@ref(fig:parallel-analysis). The seven factor solution was rotated using varimax and oblimin rotations. An examination of loadings matrix for varimax rotation Table\ \@ref(tab:varimaxTable) and structure matrix for oblimin rotation Table\ \@ref(tab:obliminTable)  indicate a clear emergence of the first three factors -Extraversion, Neuroticism, Agreeableness - indicating the respective items with highest loading on those factors. The last two factors - Conscientiousness and Openness - tend to split into multiple factors. 

# Discussion

Althought the t-test indicated significant differences overlaps seen in the errorbars indicate that no main differences can be seen in the plots. Openness and conscientiousness split into more factors which indicate a rather interesting groupings of variables into factors for this data. One could further look at inter item consistency values for these groups of 7 factors for the data. 



\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
